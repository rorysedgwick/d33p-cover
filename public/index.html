<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title>187</title>
    <!-- <link rel="stylesheet" type="text/css" href="main.css"> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  </head>
  <body>
    <div class row>
      <div class="col-md-8">
        <div class="btn-group">
        <button type="button" class="" id="d2004"> 2004 </button>
        <button type="button" class="" id="d2005"> 2005 </button>
        <button type="button" class="" id="d2006"> 2006 </button>
        <button type="button" class="" id="d2007"> 2007 </button>
        <button type="button" class="" id="d2008"> 2008 </button>
        <button type="button" class="" id="d2009"> 2009 </button>
        <button type="button" class="" id="d2010"> 2010 </button>
        <button type="button" class="" id="d2011"> 2011 </button>
        <button type="button" class="" id="d2012"> 2012 </button>
        <button type="button" class="" id="d2013"> 2013 </button>
        <button type="button" class="" id="d2014"> 2014 </button>

      </div>
    </div>

  <script type="text/javascript" src="d3/d3.js"></script>
  <script type="text/javascript">

  // Horrible way of importing all CSV data on page load \\
  var dataset04, dataset05, dataset06, dataset07, dataset08, dataset09, dataset10, dataset11,dataset12, dataset13, dataset14;

  // Store all CSV data in separate variables once loaded \\
  d3.csv("./data/2004.csv", function(data) {
    dataset04 = data;
  });

  d3.csv("./data/2005.csv", function(data) {
    dataset05 = data;
  });

  d3.csv("./data/2006.csv", function(data) {
    dataset06 = data;
  });

  d3.csv("./data/2007.csv", function(data) {
    dataset07 = data;
  });

  d3.csv("./data/2008.csv", function(data) {
      dataset08 = data;
  });

  d3.csv("./data/2009.csv", function(data) {
    dataset09 = data;
  });

  d3.csv("./data/2010.csv", function(data) {
    dataset10 = data;
  });

  d3.csv("./data/2011.csv", function(data) {
    dataset11 = data;
  });

  d3.csv("./data/2012.csv", function(data) {
    dataset12 = data;
  });

  d3.csv("./data/2013.csv", function(data) {
      dataset13 = data;
  });

  d3.csv("./data/2014.csv", function(data) {
      dataset14 = data;
  });

  // On click trigger d3 render with appropriate data set \\
  d3.select("#d2004")
    .on("click", function() {
      renderD3(dataset04);
  });

  d3.select("#d2005")
    .on("click", function() {
      renderD3(dataset05);
    });

  d3.select("#d2006")
    .on("click", function() {
      renderD3(dataset06);
    });

  d3.select("#d2007")
    .on("click", function() {
      renderD3(dataset07);
    });

  d3.select("#d2008")
    .on("click", function() {
      renderD3(dataset08);
    });

  d3.select("#d2009")
    .on("click", function() {
      renderD3(dataset09);
    });

  d3.select("#d2010")
    .on("click", function() {
      renderD3(dataset10);
  });

  d3.select("#d2011")
    .on("click", function() {
      renderD3(dataset11);
    });

  d3.select("#d2012")
    .on("click", function() {
      renderD3(dataset12);
    });

  d3.select("#d2013")
    .on("click", function() {
      renderD3(dataset13);
    });

  d3.select("#d2014")
    .on("click", (function() {
      renderD3(dataset14);
    }));
  // // ------------------------- end terrible data importing method ------------------------- \\ \\

function renderD3(dataset) {

  var noneReg       = new RegExp("no formal qualification", "i");
  var studyingReg   = new RegExp("still study", "i");
  var otherReg      = new RegExp("other", "i");
  var gcseReg       = new RegExp("g(cs|sc)e\/o-level\/cse", "i");
  var vocationalReg = new RegExp("Vocational", "i");
  var aLevelReg     = new RegExp("a-level or equivalent", "i");
  var bachelorsReg  = new RegExp("bachelor degree or equivalent", "i");
  var mastersPhdReg = new RegExp("phd or equivalent", "i");

  var NaNCounter = 0;

  var finalData = [
  { qual: "none",        qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} },
  { qual: "studying",    qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} },
  { qual: "other",       qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} },
  { qual: "gcse",        qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} },
  { qual: "vocational",  qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} },
  { qual: "aLevel",      qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} },
  { qual: "bachelors",   qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} },
  { qual: "mastersPhd",  qualNum: 0, percent: 0, totalInc: 0, avgInc: 0, gender: {male: 0, female: 0} }

  ];

  // Calculate qualification frequencies, relative percent and average incomes  \\
  calculateDataset = function() {
    var totalPeople = dataset.length;

    dataset.forEach(function(d) {
      if((d.qual.match(noneReg))) {
        d.fihhyr2_m = +d.fihhyr2_m;
        if (isNaN(d.fihhyr2_m)) {
          NaNCounter += 1;
        } else if(!isNaN(d.fihhyr2_m)) {
          finalData[0].qualNum += 1;
          finalData[0].totalInc += d.fihhyr2_m;
          finalData[0].avgInc = finalData[0].totalInc / finalData[0].qualNum;
          finalData[0].percent = finalData[0].qualNum / (totalPeople - NaNCounter) * 100;
        }
      }
      else if (d.qual.match(studyingReg)) {
        d.fihhyr2_m = +d.fihhyr2_m;
          if (isNaN(d.fihhyr2_m)) {
          NaNCounter += 1;
        } else if(!isNaN(d.fihhyr2_m)) {
          finalData[1].qualNum += 1;
          finalData[1].totalInc += d.fihhyr2_m;
          finalData[1].avgInc = finalData[1].totalInc / finalData[1].qualNum;
          finalData[1].percent = finalData[1].qualNum / (totalPeople - NaNCounter) * 100;
        }
      }
      else if (d.qual.match(otherReg)) {
        d.fihhyr2_m = +d.fihhyr2_m;
        if(!isNaN(d.fihhyr2_m)) {
          finalData[2].qualNum += 1;
          finalData[2].totalInc += d.fihhyr2_m;
          finalData[2].avgInc = finalData[2].totalInc / finalData[2].qualNum;
          finalData[2].percent = finalData[2].qualNum / (totalPeople - NaNCounter) * 100;
        }
      }
      else if (d.qual.match(gcseReg)) {
        d.fihhyr2_m = +d.fihhyr2_m;
        if (isNaN(d.fihhyr2_m)) {
          NaNCounter += 1;
        } else if(!isNaN(d.fihhyr2_m)) {
          finalData[3].qualNum += 1;
          finalData[3].totalInc += d.fihhyr2_m;
          finalData[3].avgInc = finalData[3].totalInc / finalData[3].qualNum;
          finalData[3].percent = finalData[3].qualNum / (totalPeople - NaNCounter) * 100;
        }
      }
      else if (d.qual.match(vocationalReg)) {
        d.fihhyr2_m = +d.fihhyr2_m;
        if (isNaN(d.fihhyr2_m)) {
          NaNCounter += 1;
        } else if(!isNaN(d.fihhyr2_m)) {
          finalData[4].qualNum += 1;
          finalData[4].totalInc += d.fihhyr2_m;
          finalData[4].avgInc = finalData[4].totalInc / finalData[4].qualNum;
          finalData[4].percent = finalData[4].qualNum / (totalPeople - NaNCounter) * 100;
        }
      }
      else if (d.qual.match(aLevelReg)) {
        d.fihhyr2_m = +d.fihhyr2_m;
        if (isNaN(d.fihhyr2_m)) {
          NaNCounter += 1;
        } else if(!isNaN(d.fihhyr2_m)) {
          finalData[5].qualNum += 1;
          finalData[5].totalInc += d.fihhyr2_m;
          finalData[5].avgInc = finalData[5].totalInc / finalData[5].qualNum;
          finalData[5].percent = finalData[5].qualNum / (totalPeople - NaNCounter) * 100;
        }
      }
      else if (d.qual.match(bachelorsReg)) {
        d.fihhyr2_m = +d.fihhyr2_m;
        if (isNaN(d.fihhyr2_m)) {
          NaNCounter += 1;
        } else if(!isNaN(d.fihhyr2_m)) {
          finalData[6].qualNum += 1;
          finalData[6].totalInc += d.fihhyr2_m;
          finalData[6].avgInc = finalData[6].totalInc / finalData[6].qualNum;
          finalData[6].percent = finalData[6].qualNum / (totalPeople - NaNCounter) * 100;
        }
      }
      else if (d.qual.match(mastersPhdReg)) {
        d.fihhyr2_m = +d.fihhyr2_m;
        if (isNaN(d.fihhyr2_m)) {
          NaNCounter += 1;
        } else if(!isNaN(d.fihhyr2_m)) {
          finalData[7].qualNum += 1;
          finalData[7].totalInc += d.fihhyr2_m;
          finalData[7].avgInc = finalData[7].totalInc / finalData[7].qualNum;
          finalData[7].percent = (finalData[7].qualNum / (totalPeople - NaNCounter)) * 100;
        }
      } else {
        console.log("no match found", d.qual);
      }
    });

  }();


  // Calculate average age of total dataset. Those giving stupid answers are removed from data being used for calculation \\
  averageAge = function() {
    var totalAge = 0;
    var idiots = [];
    dataset.forEach(function(d) {
      d.age = +d.age;
      if (isNaN(d.age)) {
        idiots.push(d);
        dataset.splice(dataset.indexOf(d), 1);
      } else {
        totalAge += d.age;
      }
    });

    var avgAge = totalAge / dataset.length;
    // console.log(avgAge);
  }();


  // LET THE D3 MADNESS BEGIN \\
  // ------------------------ //

  var w = 600;
  var h = 200;
  var padding = w - 20;

  var xScale = d3.scale.ordinal()
                       .domain(d3.range(finalData.length))
                       .rangeRoundBands([padding, w - padding], 0.25);

  var yScaleQual = d3.scale.linear()
                           .domain([0, d3.max(finalData, function(d) { return d.qualNum; }) ])
                           .range([h- padding, padding]);

  var yScaleInc = d3.scale.linear()
                          .domain([0, d3.max(finalData, function(d) { return d.avgInc; }) ])
                          .range([h - padding, padding]);

  var xAxis = d3.svg.axis()
                    .scale(xScale)
                    .tickFormat(function(d) { return d.qual; })
                    .orient("bottom");

  var yAxisLeft = d3.svg.axis()
                        .scale(yScaleQual)
                        .ticks(10)
                        .orient("left");

  var yAxisRight = d3.svg.axis()
                         .scale(yScaleInc)
                         .ticks(10)
                         .orient("right");


  var svg = d3.select("body")
              .append("svg")
              .attr({
                width: w,
                height: h,
              });


  svg.selectAll("rect")
     .data(finalData)
     .enter()
     .append("rect")
     .attr({
        x: function(d, i) { return xScale(i); },
        y: function(d) { return (yScaleQual(d.qualNum)); },
        "width": function(d) { return xScale.rangeBand(); },
        "height": function(d) {return h - yScaleQual(d.qualNum) - padding; },
        "fill": "grey"
      });



}

  </script>
  </body>

</html>
